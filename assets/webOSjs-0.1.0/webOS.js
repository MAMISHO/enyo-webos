!function(){window.webOS=window.webOS||{}}(),function(){try{var e=JSON.parse(PalmSystem.deviceInfo);webOS.device=e}catch(t){webOS.device={}}}(),function(){if(webOS.platform={},window.PalmSystem)if(navigator.userAgent.indexOf("SmartWatch")>-1)webOS.platform.watch=!0;else if(navigator.userAgent.indexOf("SmartTV")>-1||navigator.userAgent.indexOf("Large Screen")>-1)webOS.platform.tv=!0;else if(webOS.device.platformVersionMajor&&webOS.device.platformVersionMinor)try{var e=parseInt(webOS.device.platformVersionMajor),t=parseInt(webOS.device.platformVersionMinor);3>e||3==e&&0>=t?webOS.platform.legacy=!0:webOS.platform.open=!0}catch(o){webOS.platform.open=!0}else webOS.platform.open=!0;else webOS.platform.unknown=!0}(),function(){webOS.fetchAppId=function(){return window.PalmSystem?PalmSystem.identifier.split(" ")[0]:void 0},webOS.fetchAppInfo=function(){if(!this.appInfo){var e=function(e){if(window.palmGetResource)try{return palmGetResource(e)}catch(t){console.log("error reading appinfo.json"+t.message)}else{var o=new XMLHttpRequest;if(o.open("GET",e+"?palmGetResource=true",!1),o.send(null),o.status>=200&&o.status<300)return o.responseText;console.log("error reading appinfo.json")}},t=this.fetchAppId(),o=[this.fetchAppRootPath()+"appinfo.json","file:///media/cryptofs/apps/usr/palm/applications/"+t+"/appinfo.json","file:///usr/palm/applications/"+t+"/appinfo.json"],n=o[0].indexOf(t);n>-1&&o.unshift(o[0].substring(0,n)+t+"/appinfo.json");for(var i=void 0,s=0;s<o.length&&!i;s++)i=e(o[s]);i&&(this.appInfo=enyo.json.parse(i))}return this.appInfo},webOS.fetchAppRootPath=function(){var e=window.location.href;if("baseURI"in window.document)e=window.document.baseURI;else{var t=window.document.getElementsByTagName("base");t.length>0&&(e=t[0].href)}var o=e.match(new RegExp(".*://[^#]*/"));return o?o[0]:""}}(),function(){webOS.feedback={play:function(e){if(webOS&&webOS.platform&&webOS.platform.watch){var t={name:e||"touch",sink:"pfeedback"};if(!window.PalmServiceBridge)return;webOS.service.request("luna://com.palm.audio/systemsounds",{method:"playFeedback",parameters:t,subscribe:!1,resubscribe:!1})}}}}(),function(){var e=!(webOS.platform.legacy&&webOS.device.platformVersionMajor&&parseInt(webOS.device.platformVersionMajor)<3);if(e){var t={};Mojo=window.Mojo||{},Mojo.keyboardShown=function(e){t.isShowing=e},webOS.keyboard={types:{text:0,password:1,search:2,range:3,email:4,number:5,phone:6,url:7,color:8},isShowing:function(){return t.isShowing||!1},show:function(e){this.isManualMode()&&window.PalmSystem&&PalmSystem.keyboardShow(e||0)},hide:function(){this.isManualMode()&&window.PalmSystem&&PalmSystem.keyboardHide()},setManualMode:function(e){t.manual=e,window.PalmSystem&&PalmSystem.setManualKeyboardEnabled(e)},isManualMode:function(){return t.manual||!1},forceShow:function(e){this.setManualMode(!0),window.PalmSystem&&PalmSystem.keyboardShow(e||0)},forceHide:function(){this.setManualMode(!0),window.PalmSystem&&PalmSystem.keyboardHide()}}}}(),function(){if((webOS.platform.legacy||webOS.platform.open)&&!window.cordova){var e=function(e,t){var o=document.createEvent("Events");o.initEvent(e,!1,!1);for(var n in t)o[n]=t[n];document.dispatchEvent(o)};Mojo=window.Mojo||{};var t=JSON.parse(PalmSystem.launchParams||"{}")||{};e("webOSLaunch",{type:"webOSLaunch",detail:t}),window.Mojo.relaunch=function(t){var o=JSON.parse(PalmSystem.launchParams||"{}")||{};return o["palm-command"]&&"open-app-menu"==o["palm-command"]?(e("menubutton",{}),!0):void e("webOSRelaunch",{type:"webOSRelaunch",detail:o})},window.PalmSystem&&window.PalmSystem.stageReady()}}(),function(){webOS.notification={showToast:function(e,t){var o=e.message||"",n=e.icon||"",i=webOS.fetchAppId(),s=e.appId||i,a=e.params||{},r=e.target,c=e.noaction,l=e.stale||!1,m=e.soundClass||"",u=e.soundFile||"",w=e.soundDurationMs||"";if(webOS.platform.legacy||webOS.platform.open){var d=(e.response||{banner:!0},PalmSystem.addBannerMessage(o,JSON.stringify(a),n,m,u,w));t&&t(d)}else{o.length>60&&console.warn("Toast notification message is longer than recommended. May not display as intended");var p={sourceId:i,message:o,stale:l,noaction:c};n&&n.length>0&&(p.iconUrl=n),c||(p.onclick=r?{target:r}:{appId:s,params:a}),this.showToastRequest=webOS.service.request("palm://com.webos.notification",{method:"createToast",parameters:p,onSuccess:function(e){t&&t(e.toastId)},onFailure:function(e){console.error("Failed to create toast: "+JSON.stringify(e)),t&&t()}})}},removeToast:function(e){if(webOS.platform.legacy||webOS.platform.open)try{PalmSystem.removeBannerMessage(e)}catch(t){console.warn(t),PalmSystem.clearBannerMessage()}else this.removeToastRequest=webOS.service.request("palm://com.webos.notification",{method:"closeToast",parameters:{toastId:e}})},supportsDashboard:function(){return webOS.platform.legacy||webOS.platform.open},showDashboard:function(e,t){if(webOS.platform.legacy||webOS.platform.open){var o=window.open(e,"_blank",'attributes={"window":"dashboard"}');return t&&o.document.write(t),o.PalmSystem&&o.PalmSystem.stageReady(),o}console.warn("Dashboards are not supported on this version of webOS.")}}}(),function(){webOS.orientation={setOrientation:function(e){window.PalmSystem&&PalmSystem.setWindowOrientation&&PalmSystem.setWindowOrientation(e)},getOrientation:function(){return window.PalmSystem&&PalmSystem.setWindowOrientation?PalmSystem.windowOrientation:"up"}}}(),function(){var e=0,t=1,o=2,n=3,i=4,s=5,a=6,r=7,c=function(e){return!!e&&"object"==typeof e&&"[object Array]"!==Object.prototype.toString.call(e)},l=function(e,t,o,i){window.PalmSystem&&(o&&!c(o)&&(e=n,o={msgid:t},t="MISMATCHED_FMT",i=null,console.warn("webOSLog called with invalid format: keyVals must be an object")),t||e==r||console.warn("webOSLog called with invalid format: messageId was empty"),o&&(o=JSON.stringify(o)),window.PalmSystem.PmLogString?e==r?window.PalmSystem.PmLogString(e,null,null,i):window.PalmSystem.PmLogString(e,t,o,i):console.error("Unable to send log; PmLogString not found in this version of PalmSystem"))};webOS.emergency=function(t,o,n){l(e,t,o,n)},webOS.alert=function(e,o,n){l(t,e,o,n)},webOS.critical=function(e,t,n){l(o,e,t,n)},webOS.error=function(e,t,o){l(n,e,t,o)},webOS.warning=function(e,t,o){l(i,e,t,o)},webOS.notice=function(e,t,o){l(s,e,t,o)},webOS.info=function(e,t,o){l(a,e,t,o)},webOS.debug=function(e){l(r,"","",e)}}(),function(){function e(e,t){this.uri=e,t=t||{},t.method&&("/"!=this.uri.charAt(this.uri.length-1)&&(this.uri+="/"),this.uri+=t.method),"function"==typeof t.onSuccess&&(this.onSuccess=t.onSuccess),"function"==typeof t.onFailure&&(this.onFailure=t.onFailure),"function"==typeof t.onComplete&&(this.onComplete=t.onComplete),this.params="object"==typeof t.parameters?t.parameters:{},this.subscribe=t.subscribe||!1,this.subscribe&&(this.params.subscribe=t.subscribe),this.params.subscribe&&(this.subscribe=this.params.subscribe),this.resubscribe=t.resubscribe||!1,this.send()}e.prototype.send=function(){if(!window.PalmServiceBridge)return void console.error("PalmServiceBridge not found.");this.bridge=new PalmServiceBridge;var t=this;this.bridge.onservicecallback=this.callback=function(o){var n;if(!t.cancelled){try{n=JSON.parse(o)}catch(i){n={errorCode:-1,errorText:o}}(n.errorCode||0==n.returnValue)&&t.onFailure?(t.onFailure(n),t.resubscribe&&t.subscribe&&(t.delayID=setTimeout(function(){t.send()},e.resubscribeDelay))):t.onSuccess&&t.onSuccess(n),t.onComplete&&t.onComplete(n),t.subscribe||t.cancel()}},this.bridge.call(this.uri,JSON.stringify(this.params))},e.prototype.cancel=function(){this.cancelled=!0,this.resubscribeJob&&clearTimeout(this.delayID),this.bridge&&(this.bridge.cancel(),this.bridge=void 0)},e.prototype.toString=function(){return"[LS2Request]"},e.resubscribeDelay=1e4,webOS.service={request:function(t,o){return new e(t,o)},systemPrefix:webOS.platform.legacy||webOS.platform.open?"com.palm.":"com.webos.",protocol:webOS.platform.legacy&&webOS.device.platformVersionMajor&&parseInt(webOS.device.platformVersionMajor)<=1?"palm://":"luna://"},navigator.service={request:webOS.service.request},navigator.service.Request=navigator.service.request}(),function(){webOS.libVersion="0.1.0"}(),function(){webOS.voicereadout={readAlert:function(e){if(webOS&&webOS.platform&&webOS.platform.watch){var t,o,n=function(e){webOS.service.request("luna://com.webos.settingsservice",{method:"getSystemSettings",parameters:{category:"VoiceReadOut"},onSuccess:function(t){t&&t.settings.talkbackEnable&&e()},onFailure:function(e){console.error("Failed to get system VoiceReadOut settings: "+JSON.stringify(e))}})},i=function(e){webOS.service.request("luna://com.webos.settingsservice",{method:"getSystemSettings",parameters:{keys:["localeInfo"]},onSuccess:function(o){t=o.settings.localeInfo.locales.TTS,e()},onFailure:function(e){console.error("Failed to get system localeInfo settings: "+JSON.stringify(e))}})},s=function(e){webOS.service.request("luna://com.webos.settingsservice",{method:"getSystemSettings",parameters:{category:"option",key:"ttsSpeechRate"},onSuccess:function(t){o=Number(t.settings.ttsSpeechRate),e()},onFailure:function(e){console.error("Failed to get system speechRate settings: "+JSON.stringify(e))}})},a=function(){webOS.service.request("luna://com.lge.service.tts",{method:"speak",parameters:{locale:t,text:e,speechRate:o}})};n(function(){i(function(){s(a)})})}else if(webOS&&webOS.platform&&webOS.platform.tv){var r=function(e){webOS.service.request("luna://com.webos.settingsservice",{method:"getSystemSettings",parameters:{keys:["audioGuidance"],category:"option"},onSuccess:function(t){t&&"on"===t.settings.audioGuidance&&e()},onFailure:function(e){console.error("Failed to get system AudioGuidance settings: "+JSON.stringify(e))}})},a=function(){webOS.service.request("luna://com.webos.service.tts",{method:"speak",parameters:{text:e,clear:!0},onFailure:function(e){console.error("Failed to readAlertMessage: "+JSON.stringify(e))}})};r(a)}else console.warn("Platform doesn't support TTS api.")}}}(),function(){webOS.window={launchParams:function(e){return e=e||window,e.PalmSystem?JSON.parse(e.PalmSystem.launchParams||"{}")||{}:{}},isActivated:function(e){return e=e||window,e.PalmSystem?e.PalmSystem.isActivated:!1},activate:function(e){e=e||window,e.PalmSystem&&e.PalmSystem.activate()},deactivate:function(e){e=e||window,e.PalmSystem&&e.PalmSystem.deactivate()},newCard:function(e,t){e||webOS.platform.legacy||webOS.platform.open||(e="about:blank");var o=window.open(e);return t&&o.document.write(t),o.PalmSystem&&o.PalmSystem.stageReady(),o},setFullScreen:function(e){window.PalmSystem&&PalmSystem.enableFullScreenMode&&PalmSystem.enableFullScreenMode(e)},setWindowProperties:function(e,t){1==arguments.length&&(t=e,e=window),e.PalmSystem&&e.PalmSystem.setWindowProperties&&(e.webOS.window.properties=t=t||{},e.PalmSystem.setWindowProperties(t))},getWindowProperties:function(e){return e=e||window,e.webOS.window.properties=e.webOS.window.properties||{},e.webOS.window.properties},blockScreenTimeout:function(e){webOS.window.properties.blockScreenTimeout=e,this.setWindowProperties(navigator.windowProperties)},setSubtleLightbar:function(e){webOS.window.properties.setSubtleLightbar=e,this.setWindowProperties(webOS.window.properties)},setFastAccelerometer:function(e){webOS.window.properties.fastAccelerometer=e,this.setWindowProperties(webOS.window.properties)}}}();
